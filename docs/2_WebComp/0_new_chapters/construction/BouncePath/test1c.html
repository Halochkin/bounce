<script src="../EventLoop/HTMLEventElement_dynamo.js"></script>
<script>
  customElements.define('matroschka-inner', class MatroschkaInnerSlot extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({mode: "open"}).innerHTML = '<i><slot></slot></i>';
    }
  });
  customElements.define('matroschka-slot', class MatroschkaSlot extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({mode: "open"}).innerHTML = '<m><matroschka-inner><slot></slot></matroschka-inner></m>';
    }
  });
</script>

<matroschka-slot>
  <h1>hello sunshine</h1>
</matroschka-slot>

<script>
  const h1 = document.querySelector("h1");
  const res = new Map();
  for (let {target, root, depth, pos} of HTMLEventElement.dynamo_core(h1, true)) {
    let ar = res.get(root)?.path ?? [];
    ar.push(target);
    res.set(root, {path: ar, depth, pos});
  }
  for (let {path} of res.values())
    console.log(...path.map(n => n.nodeName));

  function toString(list) {
    let res = '';
    for (let {path, pos, depth} of list) {
      const dots = Array(depth * 2).fill('.').join('');
      const path2 = path.map(n => n.nodeName).join(',');
      res += `${dots}${pos}:${path2}\n`;
    }
    return res.trim();
  }

  console.log(toString(res.values()));
</script>