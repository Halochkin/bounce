<script>
  var res = [];

  function check(x) {
    res.push(x)
    Promise.resolve().then(() => res.push(x + "m"));
    Promise.resolve().then(() => Promise.resolve().then(() => res.push(x + "mm")));
  }

  document.addEventListener('beforescriptexecute', e => check(e.target.textContent[0]), true);

  document.addEventListener('readystatechange', function () {
    console.log(res.join(','), res.join(',') === '1,1m,1mm,2,2m,2mm,3,3m,3mm,4,4m,4mm,5,5m,5mm,6,6m,6mm');
    console.log(document.readyState, document.readyState === 'interactive');
  }, {once: true});

  const tests = [4, 2];
  customElements.define('web-comp', class WebComp extends HTMLElement {
    constructor() {
      super();
      check(tests.pop());
    }
  });
</script>

<script src="beforescriptexecute.js"></script>

<body>
<h3>Test of beforescriptexecute</h3>
<!--1--><web-comp a>
  <!--3--><web-comp b></web-comp>
</web-comp>

<script>5; check(6);</script>
</body>