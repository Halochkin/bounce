<script src="../MonkeyPatch/MonkeyPatch.js"></script>
<script src="../ParserBreakEvent/ParserBreakEvent.js"></script>
<script src="../constructionFrame/constructionFrame.js"></script>
<script src="../childChanged/ChildChangedCallback.js"></script>
<script src="../BouncePath/BouncePath.js"></script>
<script src="../EventListenerRegistry/EventListenerRegistry.js"></script>
<script src="ElementEvent.js"></script>
<script src="HTMLEventElement.js"></script>
<script src="HTMLTaskElement.js"></script>
<script src="EventLoop.js"></script>

<event-loop>
    <task :created="1631618371262" :delay="3000" :cb="printRes" :start="1631789839549">
        <task :created="1631618374265" :delay="2000" :start="1631789839346" :cb="plus">
            <task :created="1631618374264" :delay="2000" :start="1631789839347" :cb="multiply">
                <task :created="1631618374262" :delay="2000" :start="1631789839348" :cb="divide">
                    <json>6</json>
                    <json>1</json>
                </task>
                <json>2</json>
                <json>5</json>
            </task>
            <json>3</json>
        </task>
    </task>
</event-loop>

<script>
  window.printRes = function () {
    const taskElements = document.documentElement.querySelectorAll("task[\\:res]");
    console.log([...taskElements].map(n => n?.attributes?.[":res"]?.value))
  }

  window.multiply = function (...args) {
    return args.reduce((sum, value) => parseInt(sum) * parseInt(value));
  }

  window.divide = function (...args) {
    return args.reduce((sum, value) => parseInt(sum) / parseInt(value));
  }

  window.plus = function (...args) {
    return args.reduce((sum, value) => parseInt(sum) + parseInt(value));
  }
</script>